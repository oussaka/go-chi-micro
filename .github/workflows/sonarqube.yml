name: SonarQube Analysis

on:
    push:
        branches:
            - master # Change this to the branch you want to analyze

jobs:
    sonarqube:
        name:    SonarQube Scan
        runs-on: ubuntu-latest

        steps:
            -   name: Checkout code
                uses: actions/checkout@v2

            -   name: Set up Go
                uses: actions/setup-go@v2
                with:
                    go-version: 1.x # Change this to your desired Go version

            -   name: Build Go project
                run:  go build

            -   name: Run SonarQube Scanner
                uses: sonarsource/sonarqube-scan-action@v1
                env:
                    GITHUB_TOKEN:   ${{ secrets.GITHUB_TOKEN }}  # Needed to get PR information
                    SONAR_TOKEN:    ${{ secrets.SONAR_TOKEN }}   # Generate a token on SonarQube, add it to the secrets of this repo with the name SONAR_TOKEN (Settings > Secrets > Actions > add new repository secret)
                    SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}   # add the URL of your instance to the secrets of this repo with the name SONAR_HOST_URL (Settings > Secrets > Actions > add new repository secret)
                with:
                    projectBaseDir: ./ # Set this to the project's base directory